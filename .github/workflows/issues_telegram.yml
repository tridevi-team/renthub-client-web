name: Send Telegram Message on Issue/PR

on:
  issues:
    types: [opened, closed, assigned, labeled]  # B·ªï sung s·ª± ki·ªán labeled
  pull_request:
    types: [opened, closed, assigned]

jobs:
  notify-telegram:
    runs-on: ubuntu-latest
    steps:
    - name: Send message to Telegram
      env:
        TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_TO }}
        ACTION: ${{ github.event.action }}  # Tr·∫°ng th√°i (opened, closed, assigned, labeled)
        ISSUE_TITLE: ${{ github.event.issue.title || github.event.pull_request.title }}
        ISSUE_URL: ${{ github.event.issue.html_url || github.event.pull_request.html_url }}
        ISSUE_CREATOR: ${{ github.event.issue.user.login || github.event.pull_request.user.login }}  # Ng∆∞·ªùi t·∫°o
        ASSIGNEE: ${{ github.event.issue.assignee.login || github.event.pull_request.assignee.login || 'None' }}  # Ng∆∞·ªùi ƒë∆∞·ª£c assign
        ISSUE_DESCRIPTION: ${{ github.event.issue.body || github.event.pull_request.body || 'No description provided.' }}  # M√¥ t·∫£ c·ªßa issue/PR
        ISSUE_LABEL: ${{ github.event.label.name || 'No label' }}  # Nh√£n ƒë∆∞·ª£c g√°n
      run: |
        # X√°c ƒë·ªãnh icon v√† tr·∫°ng th√°i d·ª±a tr√™n action
        if [[ "${ACTION}" == "opened" ]]; then
          STATUS_ICON="üü¢"
          STATUS="Opened"
          MESSAGE_TITLE="New Issue Created"
        elif [[ "${ACTION}" == "closed" ]]; then
          STATUS_ICON="üî¥"
          STATUS="Closed"
          MESSAGE_TITLE="Issue Closed"
        elif [[ "${ACTION}" == "assigned" ]]; then
          STATUS_ICON="üë§"
          STATUS="Assigned"
          MESSAGE_TITLE="Issue Assigned"
        elif [[ "${ACTION}" == "labeled" ]]; then
          STATUS_ICON="üè∑Ô∏è"
          STATUS="Labeled"
          MESSAGE_TITLE="Label Added to Issue"
        fi

        # T·∫°o n·ªôi dung tin nh·∫Øn v·ªõi markdown v√† icon, bao g·ªìm c·∫£ description v√† label n·∫øu c√≥
        MESSAGE="*${MESSAGE_TITLE}*%0A%0A\
        *${STATUS_ICON} Issue/PR Status: ${STATUS}*%0A%0A\
        üìã *Title*: ${ISSUE_TITLE}%0A%0A\
        üîó *Link*: [View here](${ISSUE_URL})%0A%0A\
        üë§ *Created by*: ${ISSUE_CREATOR}%0A%0A\
        üë• *Assigned to*: ${ASSIGNEE}%0A%0A\
        üè∑Ô∏è *Label*: ${ISSUE_LABEL}%0A%0A\
        üìù *Description*: ${ISSUE_DESCRIPTION}"

        # G·ª≠i tin nh·∫Øn t·ªõi Telegram
        curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage" \
        -d chat_id="${TELEGRAM_CHAT_ID}" \
        -d text="${MESSAGE}" \
        -d parse_mode="Markdown"
